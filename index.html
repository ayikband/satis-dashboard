<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyÄ±k Band Sales Dashboard</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- External Libs -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <img src="https://www.konveyorbant.com/wp-content/themes/ayik-band/assets/image/logo/logo2.svg"
                alt="AyÄ±k Band Logo" class="logo">
            <div class="brand-text">
                <h1>SatÄ±ÅŸ Paneli</h1>
                <span class="subtitle">Performans Ã–zeti</span>
            </div>
        </div>
        <div class="header-right">
            <div class="quarter-badge" id="quarterLabel">Ã‡-- ----</div>
            <button id="exportPdfBtn" class="btn btn-primary" style="margin-right: 10px;">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                        d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                    <path
                        d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                </svg>
                PDF Ä°ndir
            </button>
            <button id="ratesBtn" class="btn btn-secondary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1H1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" />
                    <path
                        d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V5zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2H3z" />
                </svg>
                Kurlar
            </button>
            <button id="targetsBtn" class="btn btn-secondary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                        d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z" />
                </svg>
                Hedefler
            </button>
        </div>
    </header>

    <!-- Upload Overlay (Initial State) -->
    <div id="uploadOverlay" class="upload-overlay">
        <div class="upload-card">
            <h2>SatÄ±ÅŸ Verilerini YÃ¼kle</h2>
            <p>Analize baÅŸlamak iÃ§in Excel dosyanÄ±zÄ± yÃ¼kleyin.</p>
            <label for="fileInput" class="upload-area">
                <span class="icon">ğŸ“‚</span>
                <span class="text">.xlsx DosyasÄ± SeÃ§mek Ä°Ã§in TÄ±klayÄ±n</span>
            </label>
            <input type="file" id="fileInput" accept=".xlsx, .xls" hidden>
            <p class="file-status" id="uploadStatus">Dosya seÃ§ilmedi</p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <main id="mainDashboard" class="hidden">

        <!-- Sticky Filter Bar -->
        <section class="filter-bar">
            <div class="filter-group">
                <select id="filterMonth">
                    <option value="">TÃ¼m Aylar</option>
                </select>
                <select id="filterManager">
                    <option value="">TÃ¼m BÃ¶lge MÃ¼dÃ¼rleri</option>
                </select>
                <select id="filterRegion">
                    <option value="">TÃ¼m BÃ¶lgeler</option>
                </select>
                <select id="filterCity">
                    <option value="">TÃ¼m Åehirler</option>
                </select>
                <select id="filterType">
                    <option value="">TÃ¼m Tipler</option>
                </select>
                <select id="filterCurrency">
                    <option value="">TÃ¼m Para Birimleri</option>
                </select>
            </div>
            <div class="filter-actions">
                <div class="search-wrapper">
                    <input type="text" id="custSearch" placeholder="MÃ¼ÅŸteri Ara...">
                </div>
                <div class="toggle-wrapper" title="NormalleÅŸtirilmiÅŸ EUR ve Orijinal Para Birimi arasÄ±nda geÃ§iÅŸ yap">
                    <label class="switch">
                        <input type="checkbox" id="currencyToggle" checked>
                        <span class="slider round"></span>
                    </label>
                    <span class="toggle-label">EUR KarÅŸÄ±lÄ±ÄŸÄ±</span>
                </div>
                <button id="resetFiltersBtn" class="btn btn-outline">SÄ±fÄ±rla</button>
            </div>
        </section>

        <!-- Stats Grid -->
        <section class="kpi-grid">
            <div class="card kpi-card">
                <h3>KDV HariÃ§ Toplam SatÄ±ÅŸ</h3>
                <div class="value primary" id="kpiNetSales">--</div>
                <div class="subtext" id="kpiTargetAttainment">Hedef: --%</div>
            </div>
            <div class="card kpi-card">
                <h3>Fatura SayÄ±sÄ±</h3>
                <div class="value" id="kpiInvoices">--</div>
                <div class="subtext" id="kpiAvgInv">Ort: --</div>
            </div>
            <div class="card kpi-card">
                <h3>MÃ¼ÅŸteri SayÄ±sÄ±</h3>
                <div class="value success" id="kpiCustomers">--</div>
                <div class="subtext">Bu dÃ¶nem aktif</div>
            </div>
            <div class="card kpi-card">
                <h3>ÃœrÃ¼n / Hizmet DaÄŸÄ±lÄ±mÄ±</h3>
                <div class="chart-with-legend">
                    <div class="mini-chart-wrapper">
                        <canvas id="kpiChartMix"></canvas>
                    </div>
                    <div id="kpiLegendMix" class="custom-legend small"></div>
                </div>
            </div>
        </section>

        <!-- Charts Grid -->
        <section class="charts-grid">
            <div class="card chart-card wide">
                <div class="chart-header">
                    <h3>SatÄ±ÅŸ Trendi (GÃ¼nlÃ¼k)</h3>
                    <div class="toggle-wrapper">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="weeklyToggle"> HaftalÄ±k
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="cumulativeToggle"> KÃ¼mÃ¼latif
                        </label>
                    </div>
                </div>
                <!-- Progress Bar Section -->
                <div class="target-progress-bar-container">
                    <div class="progress-info">
                        <span class="progress-label">Genel Hedef Tamamlanma</span>
                        <span class="progress-percent" id="globalProgressText">0%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="globalProgressBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="chartTrend"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <h3>BÃ¶lge MÃ¼dÃ¼rÃ¼ PerformansÄ± / Hedef</h3>
                <div class="chart-container">
                    <canvas id="chartManager"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <h3>DÃ¶viz DaÄŸÄ±lÄ±mÄ± </h3>
                <div class="chart-with-legend-side">
                    <div class="chart-wrapper">
                        <canvas id="chartCurrency"></canvas>
                    </div>
                    <div id="legendCurrency" class="custom-legend"></div>
                </div>
            </div>
            <div class="card chart-card">
                <h3>BÃ¶lgesel DaÄŸÄ±lÄ±m</h3>
                <div class="chart-container">
                    <canvas id="chartRegion"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <h3>En BÃ¼yÃ¼k 5 SatÄ±ÅŸ</h3>
                <div class="chart-container">
                    <div id="topInvoicesList" class="top-invoices-list"></div>
                </div>
            </div>
        </section>

        <!-- Top Managers Customers Grid -->
        <section class="top-customers-grid" id="topManagersCustomersSection">
            <h3 class="section-title">BÃ¶lge MÃ¼dÃ¼rleri ve MÃ¼ÅŸterileri</h3>
            <div id="topManagersCustomersContainer" class="three-col-grid">
                <!-- Injected by JS -->
            </div>
        </section>

        <!-- Data Table -->
        <section class="table-section">
            <div class="card">
                <div class="table-header-row">
                    <h3>DetaylÄ± DÃ¶kÃ¼m</h3>
                    <div class="pagination-controls">
                        Sayfa baÅŸÄ±na satÄ±r:
                        <select id="rowsPerPage">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                        </select>
                        <span id="pageInfo">1-25 / --</span>
                        <button id="prevPageFn" class="btn-sm">â€¹</button>
                        <button id="nextPageFn" class="btn-sm">â€º</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="detailTable">
                        <thead>
                            <tr>
                                <th data-sort="date">Tarih â¬</th>
                                <th data-sort="invNo">Fatura No â¬</th>
                                <th data-sort="customer">MÃ¼ÅŸteri â¬</th>
                                <th data-sort="manager">BÃ¶lge MÃ¼dÃ¼rÃ¼ â¬</th>
                                <th data-sort="region">BÃ¶lge â¬</th>
                                <th data-sort="city">Åehir â¬</th>
                                <th data-sort="type">Tip â¬</th>
                                <th data-sort="curr">Para Birimi â¬</th>
                                <th data-sort="net" class="text-right">Net (KarÅŸÄ±lÄ±k) â¬</th>
                                <th data-sort="netOrig" class="text-right">Net (Orijinal) â¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows injected by JS -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="8">TOPLAM</td>
                                <td class="text-right" id="tableTotalNet">--</td>
                                <td class="text-right"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- Targets Modal -->
    <div id="targetsModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SatÄ±ÅŸ Hedeflerini Belirle (Ã‡eyreklik - EUR)</h3>
                <button class="close-modal" id="closeTargetsBtn">Ã—</button>
            </div>
            <div class="modal-body">
                <p class="hint">Tespit edilen her bÃ¶lge mÃ¼dÃ¼rÃ¼ iÃ§in EUR cinsinden hedefleri girin. Hedefler yerel olarak
                    kaydedilir.</p>
                <div id="targetsList" class="targets-list">
                    <!-- Inputs injected here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="resetTargetsBtn">TÃ¼mÃ¼nÃ¼ SÄ±fÄ±rla</button>
                <button class="btn btn-primary" id="saveTargetsBtn">Kaydet & Uygula</button>
            </div>
        </div>
    </div>

    <!-- Rates Modal -->
    <div id="ratesModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>DÃ¶viz KurlarÄ± (EUR TabanlÄ±)</h3>
                <button class="close-modal" id="closeRatesBtn">Ã—</button>
            </div>
            <div class="modal-body">
                <p class="hint">"EUR KarÅŸÄ±lÄ±ÄŸÄ±" aktifken diÄŸer para birimlerini EUR'ya dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in manuel kurlarÄ±
                    girin. BunlarÄ± referans olarak da kullanÄ±n.</p>
                <div class="targets-list">
                    <div class="target-item">
                        <label>EUR / USD</label>
                        <input type="number" step="0.0001" id="rateUSD" placeholder="Ã¶r: 1.08">
                    </div>
                    <div class="target-item">
                        <label>EUR / GBP</label>
                        <input type="number" step="0.0001" id="rateGBP" placeholder="Ã¶r: 0.85">
                    </div>
                    <div class="target-item">
                        <label>EUR / TRY</label>
                        <input type="number" step="0.01" id="rateTRY" placeholder="Ã¶r: 35.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveRatesBtn">KurlarÄ± Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Deal Details Modal -->
    <div id="dealDetailsModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Fatura DetaylarÄ±</h3>
                <button class="close-modal" id="closeDealBtn">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="deal-details-grid" id="dealDetailsContent">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>
